name: deploy

on:
  workflow_run:
    workflows: [build]
    types: [completed]

jobs:
  deploy:
    if: github.event.workflow_run.conclusion == 'success'
    runs-on: ubuntu-latest
    steps:
      - name: Download artifact
        env:
          GH_TOKEN: ${{ github.token }}
          GH_REPO: ${{ github.repository }}
          RUN_ID: ${{ github.event.workflow_run.id }}
        run: gh run download "$RUN_ID" -n test-artifact -D output
      - name: Verify
        run: cat output/output.txt
      - name: Check secret access
        env:
          TEST_SAUCE: ${{ secrets.TEST_SAUCE }}
        run: |
          if [ -n "$TEST_SAUCE" ]; then
            echo "SECRET IS AVAILABLE (length=${#TEST_SAUCE})"
          else
            echo "SECRET IS EMPTY - running in fork context"
          fi
